---
title: "Final Project Analysis"
author: "Shelley, Steph, Lizzy, Veronica"
date: "4/15/2019"
output: pdf_document
---

```{r setup, include=FALSE}
library(plyr)
library(dplyr)
knitr::opts_chunk$set(include = FALSE, cache = TRUE)
```

```{r}
# First, load the data
ShelleyStephLizzyVeronicaDataLoad <- function(filename) 
{
  if(Sys.info()['sysname']=="Darwin"){
    macfilepath <- paste("./NLSY Data/", filename, sep = "")
     load(as.character(macfilepath), envir = globalenv())}
  else{
    windowsfilepath <- paste("~/GitHub/finalproject/NLSY Data/", filename, sep = "")
     load(as.character(windowsfilepath), envir = globalenv())
  }
}

ShelleyStephLizzyVeronicaDataLoad("NLSYdata.Rdata")
```


##Note that the variables we've chosen are:

*Exposure*: Victim of bullying prior to age 12 (bullied_bf_12_1997)
*Outcome*: Drug use during adolescence/Young adulthood (ever_new_user)

*Ws*:
Race (KEY_RACE_ETHNICITY_1997)
Sex (KEY_SEX_1997)
Sexual Orientation (anySameSex)
BMI (BMI)
Learning Disability (learning_disability_1997)
Bio Mom's Education (CV_HGC_BIO_MOM_1997)
Citizenship (CV_CITIZENSHIP_1997)
Not Living with both Biological Parents (YOUTH_BOTHBIO.01_1997)

```{r}
#some cleaning of variables to rename levels for ease of visualization
final_data$bullied_bf_12_1997 <- as.factor(final_data$bullied_bf_12_1997)
final_data$bullied_bf_12_1997 <- revalue(final_data$bullied_bf_12_1997,    
                                         c("0"="NotBullied", "1"="Bullied"))

final_data$ever_new_user2 <- as.factor(final_data$ever_new_user2)
final_data$ever_new_user2 <- revalue( final_data$ever_new_user2,
                                      c("0" = "NoDrugUse", "1" = "DrugUse"))

final_data$KEY_RACE_ETHNICITY_1997 <- as.factor(final_data$KEY_RACE_ETHNICITY_1997)
final_data$KEY_RACE_ETHNICITY_1997 <- revalue(final_data$KEY_RACE_ETHNICITY_1997,    
                                         c("1"="Black", "2"="Hispanic", "3"="MixedRace", "4"="White"))

final_data$KEY_SEX_1997 <- as.factor(final_data$KEY_SEX_1997)
final_data$KEY_SEX_1997 <- revalue(final_data$KEY_SEX_1997,    
                                         c("1"="Male", "2"="Female"))

final_data$anySameSex <- as.factor(final_data$anySameSex)
final_data$anySameSex <- revalue(final_data$anySameSex, c("FALSE" = "NoSameSex", "TRUE" = "SomeSameSex"))

final_data$learning_disability_1997 <- as.factor(final_data$learning_disability_1997)
final_data$learning_disability_1997  <- revalue(final_data$learning_disability_1997 , c("0" = "NoLearningDisability", "1" = "LearningDisability"))

final_data$CV_CITIZENSHIP_1997 <- as.factor(final_data$CV_CITIZENSHIP_1997)
final_data$CV_CITIZENSHIP_1997 <- revalue(final_data$CV_CITIZENSHIP_1997, c("1"="BornInUS", "2"="NotBornInUS", "3"="BirthplaceUnknown"))

final_data$YOUTH_BOTHBIO.01_1997 <- as.factor(final_data$YOUTH_BOTHBIO.01_1997)
final_data$YOUTH_BOTHBIO.01_1997 <- revalue(final_data$YOUTH_BOTHBIO.01_1997, c("1"="LivesWBothBioParents", "0"="DoesntLiveWBioParents"))

final_data <- final_data %>% filter(KEY_RACE_ETHNICITY_1997 != "MixedRace")
final_data$KEY_RACE_ETHNICITY_1997 <- droplevels(final_data$KEY_RACE_ETHNICITY_1997) #takes away the empty category

final_data$MomEducation <- NA
final_data$MomEducation[final_data$CV_HGC_BIO_MOM_1997 < 12] <- 0
final_data$MomEducation[final_data$CV_HGC_BIO_MOM_1997 == 12] <- 1
final_data$MomEducation[final_data$CV_HGC_BIO_MOM_1997 > 12] <- 2
final_data$MomEducation <-as.factor(final_data$MomEducation)
final_data$MomEducation <- revalue(final_data$MomEducation, c("0"="LessThanHigh", "1"="HighSchlGrad", "2"="SomeCollege"))

#dichotomous version of maternal education variable
final_data$MomEduDi <- NA
final_data$MomEduDi[final_data$CV_HGC_BIO_MOM_1997 < 12] <- 1
final_data$MomEduDi[final_data$CV_HGC_BIO_MOM_1997 == 12] <- 1
final_data$MomEduDi[final_data$CV_HGC_BIO_MOM_1997 > 12] <- 2
final_data$MomEduDi <-as.factor(final_data$MomEduDi)
final_data$MomEduDi <- revalue(final_data$MomEduDi, c("1"="HighSchlOrLess", "2"="SomeCollege"))
```


#Practical Positivity Assumption Assessment

```{r}
#just race
table(final_data$KEY_RACE_ETHNICITY_1997, useNA="ifany")

#just race and gender with exp/out
table(final_data$bullied_bf_12_1997,final_data$ever_new_user2, final_data$KEY_RACE_ETHNICITY_1997,  final_data$KEY_SEX_1997, useNA="ifany")

#just sexual orientaion and learning disability with exp/out
table(final_data$bullied_bf_12_1997,final_data$ever_new_user2,
      final_data$anySameSex, final_data$learning_disability_1997,
      useNA="ifany")

summary(final_data$anySameSex)
summary(final_data$learning_disability_1997)

#just maternal education and born in US with exp/out
table(final_data$bullied_bf_12_1997,final_data$ever_new_user2,
      final_data$MomEducation, final_data$CV_CITIZENSHIP_1997,
      useNA="ifany")

summary(final_data$CV_CITIZENSHIP_1997)
summary(final_data$YOUTH_BOTHBIO.01_1997)

#All with exp/out
table(final_data$bullied_bf_12_1997,final_data$ever_new_user2,
      final_data$KEY_RACE_ETHNICITY_1997,  final_data$KEY_SEX_1997,
      final_data$anySameSex, final_data$learning_disability_1997,
      final_data$MomEducation, final_data$CV_CITIZENSHIP_1997,
      final_data$YOUTH_BOTHBIO.01_1997,
      useNA="ifany")

#Steph's suggested set of variables
table(final_data$bullied_bf_12_1997,final_data$ever_new_user2,
      final_data$KEY_RACE_ETHNICITY_1997,  final_data$KEY_SEX_1997,
      final_data$MomEduDi, 
      final_data$YOUTH_BOTHBIO.01_1997,
      useNA="ifany")



```

